<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mister CTF</title>
    <link rel="stylesheet" href="./assets/style.css">
    <link rel="icon" href="favicon.ico">
</head>
<body class="center">
    <section class="chall">
    </section>
    <script>
        fetch('content/data.json')
        .then(response => response.json())
        .then(res => {
            let id = new URLSearchParams(document.location.search).get("stage");
            res = res[id];

            let div = document.createElement("div");

            console.log("Name : ", res.name);
            let name = document.createElement("p");
            name.innerText = `Name : ${res.name}`;
            div.appendChild(name);

            console.log("Challenge : ", res.challenge);
            let challenge = document.createElement("p");
            challenge.innerHTML = `Challenge : ${res.challenge}`;
            div.appendChild(challenge);
            
            if(res.files != null){
                let list = document.createElement("div");
                res.files.forEach(file => {
                    let container = document.createElement("div");
                    container.classList.add("file");
                    // console.log("File : ",file)
                    let a = document.createElement("a");
                    a.href = `content/${id}/${file}`;
                    a.innerText = `${file}`;
                    container.appendChild(a);
                    list.appendChild(container);
                });
                div.appendChild(list);
            }

            let input = document.createElement("input");
            input.type="text";
            input.autocomplete = "off";
            input.id = `ans-${id}`;
            div.appendChild(input);
            
            let submit = document.createElement("button");
            submit.innerText = "Submit!!"
            submit.onclick = () => judge(id);
            div.appendChild(submit);
            
            document.querySelector("section.chall").append(div)
        })
        .catch(error => {
            console.error("Error loading JSON:", error);
        });

    </script>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/md5.js"></script>
<script>
    function judge(id){
        fetch('content/data.json')
        .then(response => response.json())
        .then(res => {
            let flag = res[id].flag;
            let ans = document.getElementById(`ans-${id}`).value;
            console.log(ans);
            var hash = CryptoJS.MD5(ans);
            if(flag == hash){
                alert("Correct!!");
                alert("Get Ready for NEXT Stage!!");
                if(1 <= Number(id) && Number(id) <= 10) window.location.href = "play.html?stage=" + (Number(id) + 1);
                else window.location.href = "https://www.youtube.com/watch?v=itJ_DJVKAW0";

            }else{
                alert("Incorrect *^*");
            }
        })
        .catch(error => {
            console.error("Error loading JSON:", error);
        });
    }
</script>
</html>